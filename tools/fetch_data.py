import zipfile
from pathlib import Path

import requests


def download_file_from_nishika(
    download_url: str, dirpath: Path, unzip: bool = True
) -> None:
    """
    指定したURLからファイルをダウンロードし、指定したディレクトリに保存します。

    Args:
        download_url (str): ダウンロードするファイルのURL (データタブにある `COPY URL`)
        dirpath (Path): ファイルを保存するディレクトリのパス
        unzip (bool): ダウンロードしたファイルがZIP形式の場合に解凍するかどうかを指定。デフォルトはTrue

    Returns:
        None
    """

    # ファイルのダウンロードと保存
    response = requests.get(download_url)
    filename = download_url.split("?")[-2].split("/")[-1]
    filepath = dirpath / filename
    # print(filename)

    if not filepath.is_file():
        with open(filepath, "wb") as f:
            f.write(response.content)

        if unzip and filename.endswith(".zip"):
            # ! unzip -d $dirpath $filepath
            with zipfile.ZipFile(filepath, "r") as zip_ref:
                zip_ref.extractall(dirpath)


# 要変更
download_urls = [
    # train.csv
    "https://s3.ap-northeast-1.amazonaws.com/nishika.assets.private/competitions/48/data/train.csv?response-content-disposition=attachment%3B%20filename%3Dtrain.csv&AWSAccessKeyId=ASIA3NMWWMCV77UTEBUQ&Signature=gLrG8eQHS8gimwAx3I5YT9kRi1U%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEFEaDmFwLW5vcnRoZWFzdC0xIkcwRQIhAOHugaBtZEObMv0tWhM25FHHbTc%2BgY%2FPDepMPpLEJ8gVAiAVm2uoJBJsNN9af3JCfvIg1htdn3OM3ICf9nAN7o1%2ByyqLBAi7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAQaDDc4NDY4NDQ0MTc3MSIMFTqWjr%2FPXL3AR%2FIXKt8DYcsHZJo2I6zF86g7K3qZE1JdmMPfhuNejKmvNev2f1f9bef%2BF2Ui9wNQE4tIF7BCXDrW9kw401C2wFX3RXeYZMxI9yNIpIIW9fQbz%2FwO373uB%2FDCEFgmHpCTfQdTSxFgMh5aXotvYKKJF4Kf9OBkYl14WDU6lmHTAIKFCBPRk5DoKM6P5ZaKbP2mIMU5Zp6%2BYSOty5FBRQyKcCLKXqt68Ekih14FdbCzn7RcPou9kqzUhzW5%2FnMR3EjkfPMRQFxYoEGJAkiufx57FZ54RQwjiMtuYJK9x3h0rU4a2FAxdV6x%2F01bvnLGE6qu0ht%2BOwmdiKM7IttEc5FJw18%2FmxSwYIKNTpdPBBOwArhI%2FAjDZos5Wq1R4a9A97TMRo%2FkGKCKQ9WW8FGrIDi9CycrRElpaLoI8aaYPqBqhh6f5sBZpKAhTagvUQSv7TGnsRcbfbNdNI6tPnlB7YMmxiVOzeZf2MwIoT76h2YgwK6iC0CF0tOpG6Jo0pVRaBNprqbD9hHtDybIzOF0GGR0M4IDe3uUNMU92xLoaTI0TP6L7wNcHT3iUNJ60WVIW6BWDyMiBtjgfDW5KbpE%2B9dNxbFN2xu6bA4jVVNyNqAACYMH15%2FDC%2Bx7bSjf1xdJF5VLt8XcQDIwv%2BD%2FpAY6pQEs46aW3cza6w78w1wo0iOGW94mtQmuI%2FU3PcW1KSjHvd%2F8D2VbOnzNY5EJ9Q2HOMjCilPK5i%2FjyOFBhCdz%2BH1am0k%2F3rl7rjddnOe1BQ%2Br%2Bjn4evdDgmRVYSQwKxO2GfUqRfCjw3wKmKzgj0osYvLB9VKSRvDkmSMpciABVEmGbLmKOf6b7zCnuy8oV%2BYe%2Bg9oP196I%2FqGTBbTM1%2FVI6ReN5%2BbbAc%3D&Expires=1688219010",
    # test.csv
    "https://s3.ap-northeast-1.amazonaws.com/nishika.assets.private/competitions/48/data/test.csv?response-content-disposition=attachment%3B%20filename%3Dtest.csv&AWSAccessKeyId=ASIA3NMWWMCV77UTEBUQ&Signature=p0lJaRZnrKLFTTpfg9%2BQEBxlj7I%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEFEaDmFwLW5vcnRoZWFzdC0xIkcwRQIhAOHugaBtZEObMv0tWhM25FHHbTc%2BgY%2FPDepMPpLEJ8gVAiAVm2uoJBJsNN9af3JCfvIg1htdn3OM3ICf9nAN7o1%2ByyqLBAi7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAQaDDc4NDY4NDQ0MTc3MSIMFTqWjr%2FPXL3AR%2FIXKt8DYcsHZJo2I6zF86g7K3qZE1JdmMPfhuNejKmvNev2f1f9bef%2BF2Ui9wNQE4tIF7BCXDrW9kw401C2wFX3RXeYZMxI9yNIpIIW9fQbz%2FwO373uB%2FDCEFgmHpCTfQdTSxFgMh5aXotvYKKJF4Kf9OBkYl14WDU6lmHTAIKFCBPRk5DoKM6P5ZaKbP2mIMU5Zp6%2BYSOty5FBRQyKcCLKXqt68Ekih14FdbCzn7RcPou9kqzUhzW5%2FnMR3EjkfPMRQFxYoEGJAkiufx57FZ54RQwjiMtuYJK9x3h0rU4a2FAxdV6x%2F01bvnLGE6qu0ht%2BOwmdiKM7IttEc5FJw18%2FmxSwYIKNTpdPBBOwArhI%2FAjDZos5Wq1R4a9A97TMRo%2FkGKCKQ9WW8FGrIDi9CycrRElpaLoI8aaYPqBqhh6f5sBZpKAhTagvUQSv7TGnsRcbfbNdNI6tPnlB7YMmxiVOzeZf2MwIoT76h2YgwK6iC0CF0tOpG6Jo0pVRaBNprqbD9hHtDybIzOF0GGR0M4IDe3uUNMU92xLoaTI0TP6L7wNcHT3iUNJ60WVIW6BWDyMiBtjgfDW5KbpE%2B9dNxbFN2xu6bA4jVVNyNqAACYMH15%2FDC%2Bx7bSjf1xdJF5VLt8XcQDIwv%2BD%2FpAY6pQEs46aW3cza6w78w1wo0iOGW94mtQmuI%2FU3PcW1KSjHvd%2F8D2VbOnzNY5EJ9Q2HOMjCilPK5i%2FjyOFBhCdz%2BH1am0k%2F3rl7rjddnOe1BQ%2Br%2Bjn4evdDgmRVYSQwKxO2GfUqRfCjw3wKmKzgj0osYvLB9VKSRvDkmSMpciABVEmGbLmKOf6b7zCnuy8oV%2BYe%2Bg9oP196I%2FqGTBbTM1%2FVI6ReN5%2BbbAc%3D&Expires=1688219010",
    # sample_submission.csv
    "https://s3.ap-northeast-1.amazonaws.com/nishika.assets.private/competitions/48/data/sample_submission.csv?response-content-disposition=attachment%3B%20filename%3Dsample_submission.csv&AWSAccessKeyId=ASIA3NMWWMCV77UTEBUQ&Signature=S2D3%2B7PCGRh%2BD6KRo8wTHBEi%2B3w%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEFEaDmFwLW5vcnRoZWFzdC0xIkcwRQIhAOHugaBtZEObMv0tWhM25FHHbTc%2BgY%2FPDepMPpLEJ8gVAiAVm2uoJBJsNN9af3JCfvIg1htdn3OM3ICf9nAN7o1%2ByyqLBAi7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAQaDDc4NDY4NDQ0MTc3MSIMFTqWjr%2FPXL3AR%2FIXKt8DYcsHZJo2I6zF86g7K3qZE1JdmMPfhuNejKmvNev2f1f9bef%2BF2Ui9wNQE4tIF7BCXDrW9kw401C2wFX3RXeYZMxI9yNIpIIW9fQbz%2FwO373uB%2FDCEFgmHpCTfQdTSxFgMh5aXotvYKKJF4Kf9OBkYl14WDU6lmHTAIKFCBPRk5DoKM6P5ZaKbP2mIMU5Zp6%2BYSOty5FBRQyKcCLKXqt68Ekih14FdbCzn7RcPou9kqzUhzW5%2FnMR3EjkfPMRQFxYoEGJAkiufx57FZ54RQwjiMtuYJK9x3h0rU4a2FAxdV6x%2F01bvnLGE6qu0ht%2BOwmdiKM7IttEc5FJw18%2FmxSwYIKNTpdPBBOwArhI%2FAjDZos5Wq1R4a9A97TMRo%2FkGKCKQ9WW8FGrIDi9CycrRElpaLoI8aaYPqBqhh6f5sBZpKAhTagvUQSv7TGnsRcbfbNdNI6tPnlB7YMmxiVOzeZf2MwIoT76h2YgwK6iC0CF0tOpG6Jo0pVRaBNprqbD9hHtDybIzOF0GGR0M4IDe3uUNMU92xLoaTI0TP6L7wNcHT3iUNJ60WVIW6BWDyMiBtjgfDW5KbpE%2B9dNxbFN2xu6bA4jVVNyNqAACYMH15%2FDC%2Bx7bSjf1xdJF5VLt8XcQDIwv%2BD%2FpAY6pQEs46aW3cza6w78w1wo0iOGW94mtQmuI%2FU3PcW1KSjHvd%2F8D2VbOnzNY5EJ9Q2HOMjCilPK5i%2FjyOFBhCdz%2BH1am0k%2F3rl7rjddnOe1BQ%2Br%2Bjn4evdDgmRVYSQwKxO2GfUqRfCjw3wKmKzgj0osYvLB9VKSRvDkmSMpciABVEmGbLmKOf6b7zCnuy8oV%2BYe%2Bg9oP196I%2FqGTBbTM1%2FVI6ReN5%2BbbAc%3D&Expires=1688219010",
    # query_images.zip
    "https://s3.ap-northeast-1.amazonaws.com/nishika.assets.private/competitions/48/data/query_images.zip?response-content-disposition=attachment%3B%20filename%3Dquery_images.zip&AWSAccessKeyId=ASIA3NMWWMCV77UTEBUQ&Signature=1%2Bp3hSSibdFawg9EwNTvZ4JfZmw%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEFEaDmFwLW5vcnRoZWFzdC0xIkcwRQIhAOHugaBtZEObMv0tWhM25FHHbTc%2BgY%2FPDepMPpLEJ8gVAiAVm2uoJBJsNN9af3JCfvIg1htdn3OM3ICf9nAN7o1%2ByyqLBAi7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAQaDDc4NDY4NDQ0MTc3MSIMFTqWjr%2FPXL3AR%2FIXKt8DYcsHZJo2I6zF86g7K3qZE1JdmMPfhuNejKmvNev2f1f9bef%2BF2Ui9wNQE4tIF7BCXDrW9kw401C2wFX3RXeYZMxI9yNIpIIW9fQbz%2FwO373uB%2FDCEFgmHpCTfQdTSxFgMh5aXotvYKKJF4Kf9OBkYl14WDU6lmHTAIKFCBPRk5DoKM6P5ZaKbP2mIMU5Zp6%2BYSOty5FBRQyKcCLKXqt68Ekih14FdbCzn7RcPou9kqzUhzW5%2FnMR3EjkfPMRQFxYoEGJAkiufx57FZ54RQwjiMtuYJK9x3h0rU4a2FAxdV6x%2F01bvnLGE6qu0ht%2BOwmdiKM7IttEc5FJw18%2FmxSwYIKNTpdPBBOwArhI%2FAjDZos5Wq1R4a9A97TMRo%2FkGKCKQ9WW8FGrIDi9CycrRElpaLoI8aaYPqBqhh6f5sBZpKAhTagvUQSv7TGnsRcbfbNdNI6tPnlB7YMmxiVOzeZf2MwIoT76h2YgwK6iC0CF0tOpG6Jo0pVRaBNprqbD9hHtDybIzOF0GGR0M4IDe3uUNMU92xLoaTI0TP6L7wNcHT3iUNJ60WVIW6BWDyMiBtjgfDW5KbpE%2B9dNxbFN2xu6bA4jVVNyNqAACYMH15%2FDC%2Bx7bSjf1xdJF5VLt8XcQDIwv%2BD%2FpAY6pQEs46aW3cza6w78w1wo0iOGW94mtQmuI%2FU3PcW1KSjHvd%2F8D2VbOnzNY5EJ9Q2HOMjCilPK5i%2FjyOFBhCdz%2BH1am0k%2F3rl7rjddnOe1BQ%2Br%2Bjn4evdDgmRVYSQwKxO2GfUqRfCjw3wKmKzgj0osYvLB9VKSRvDkmSMpciABVEmGbLmKOf6b7zCnuy8oV%2BYe%2Bg9oP196I%2FqGTBbTM1%2FVI6ReN5%2BbbAc%3D&Expires=1688219010",
    # data_explanation.xlsx
    "https://s3.ap-northeast-1.amazonaws.com/nishika.assets.private/competitions/48/data/data_explanation.xlsx?response-content-disposition=attachment%3B%20filename%3Ddata_explanation.xlsx&AWSAccessKeyId=ASIA3NMWWMCV77UTEBUQ&Signature=QqoG2%2BkDkH2%2B0itxT7fN5Ot3ttk%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEFEaDmFwLW5vcnRoZWFzdC0xIkcwRQIhAOHugaBtZEObMv0tWhM25FHHbTc%2BgY%2FPDepMPpLEJ8gVAiAVm2uoJBJsNN9af3JCfvIg1htdn3OM3ICf9nAN7o1%2ByyqLBAi7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAQaDDc4NDY4NDQ0MTc3MSIMFTqWjr%2FPXL3AR%2FIXKt8DYcsHZJo2I6zF86g7K3qZE1JdmMPfhuNejKmvNev2f1f9bef%2BF2Ui9wNQE4tIF7BCXDrW9kw401C2wFX3RXeYZMxI9yNIpIIW9fQbz%2FwO373uB%2FDCEFgmHpCTfQdTSxFgMh5aXotvYKKJF4Kf9OBkYl14WDU6lmHTAIKFCBPRk5DoKM6P5ZaKbP2mIMU5Zp6%2BYSOty5FBRQyKcCLKXqt68Ekih14FdbCzn7RcPou9kqzUhzW5%2FnMR3EjkfPMRQFxYoEGJAkiufx57FZ54RQwjiMtuYJK9x3h0rU4a2FAxdV6x%2F01bvnLGE6qu0ht%2BOwmdiKM7IttEc5FJw18%2FmxSwYIKNTpdPBBOwArhI%2FAjDZos5Wq1R4a9A97TMRo%2FkGKCKQ9WW8FGrIDi9CycrRElpaLoI8aaYPqBqhh6f5sBZpKAhTagvUQSv7TGnsRcbfbNdNI6tPnlB7YMmxiVOzeZf2MwIoT76h2YgwK6iC0CF0tOpG6Jo0pVRaBNprqbD9hHtDybIzOF0GGR0M4IDe3uUNMU92xLoaTI0TP6L7wNcHT3iUNJ60WVIW6BWDyMiBtjgfDW5KbpE%2B9dNxbFN2xu6bA4jVVNyNqAACYMH15%2FDC%2Bx7bSjf1xdJF5VLt8XcQDIwv%2BD%2FpAY6pQEs46aW3cza6w78w1wo0iOGW94mtQmuI%2FU3PcW1KSjHvd%2F8D2VbOnzNY5EJ9Q2HOMjCilPK5i%2FjyOFBhCdz%2BH1am0k%2F3rl7rjddnOe1BQ%2Br%2Bjn4evdDgmRVYSQwKxO2GfUqRfCjw3wKmKzgj0osYvLB9VKSRvDkmSMpciABVEmGbLmKOf6b7zCnuy8oV%2BYe%2Bg9oP196I%2FqGTBbTM1%2FVI6ReN5%2BbbAc%3D&Expires=1688219010",
    # cite.csv
    "https://s3.ap-northeast-1.amazonaws.com/nishika.assets.private/competitions/48/data/cite.csv?response-content-disposition=attachment%3B%20filename%3Dcite.csv&AWSAccessKeyId=ASIA3NMWWMCV77UTEBUQ&Signature=YjBxmQE10e5Xi1QwRIyStJ8h1WI%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEFEaDmFwLW5vcnRoZWFzdC0xIkcwRQIhAOHugaBtZEObMv0tWhM25FHHbTc%2BgY%2FPDepMPpLEJ8gVAiAVm2uoJBJsNN9af3JCfvIg1htdn3OM3ICf9nAN7o1%2ByyqLBAi7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAQaDDc4NDY4NDQ0MTc3MSIMFTqWjr%2FPXL3AR%2FIXKt8DYcsHZJo2I6zF86g7K3qZE1JdmMPfhuNejKmvNev2f1f9bef%2BF2Ui9wNQE4tIF7BCXDrW9kw401C2wFX3RXeYZMxI9yNIpIIW9fQbz%2FwO373uB%2FDCEFgmHpCTfQdTSxFgMh5aXotvYKKJF4Kf9OBkYl14WDU6lmHTAIKFCBPRk5DoKM6P5ZaKbP2mIMU5Zp6%2BYSOty5FBRQyKcCLKXqt68Ekih14FdbCzn7RcPou9kqzUhzW5%2FnMR3EjkfPMRQFxYoEGJAkiufx57FZ54RQwjiMtuYJK9x3h0rU4a2FAxdV6x%2F01bvnLGE6qu0ht%2BOwmdiKM7IttEc5FJw18%2FmxSwYIKNTpdPBBOwArhI%2FAjDZos5Wq1R4a9A97TMRo%2FkGKCKQ9WW8FGrIDi9CycrRElpaLoI8aaYPqBqhh6f5sBZpKAhTagvUQSv7TGnsRcbfbNdNI6tPnlB7YMmxiVOzeZf2MwIoT76h2YgwK6iC0CF0tOpG6Jo0pVRaBNprqbD9hHtDybIzOF0GGR0M4IDe3uUNMU92xLoaTI0TP6L7wNcHT3iUNJ60WVIW6BWDyMiBtjgfDW5KbpE%2B9dNxbFN2xu6bA4jVVNyNqAACYMH15%2FDC%2Bx7bSjf1xdJF5VLt8XcQDIwv%2BD%2FpAY6pQEs46aW3cza6w78w1wo0iOGW94mtQmuI%2FU3PcW1KSjHvd%2F8D2VbOnzNY5EJ9Q2HOMjCilPK5i%2FjyOFBhCdz%2BH1am0k%2F3rl7rjddnOe1BQ%2Br%2Bjn4evdDgmRVYSQwKxO2GfUqRfCjw3wKmKzgj0osYvLB9VKSRvDkmSMpciABVEmGbLmKOf6b7zCnuy8oV%2BYe%2Bg9oP196I%2FqGTBbTM1%2FVI6ReN5%2BbbAc%3D&Expires=1688219010",
    # cite_images.zip
    "https://s3.ap-northeast-1.amazonaws.com/nishika.assets.private/competitions/48/data/cite_images.zip?response-content-disposition=attachment%3B%20filename%3Dcite_images.zip&AWSAccessKeyId=ASIA3NMWWMCV77UTEBUQ&Signature=W%2Bc2HHUz4GWPA%2B54q%2BaSaPdjDNA%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEFEaDmFwLW5vcnRoZWFzdC0xIkcwRQIhAOHugaBtZEObMv0tWhM25FHHbTc%2BgY%2FPDepMPpLEJ8gVAiAVm2uoJBJsNN9af3JCfvIg1htdn3OM3ICf9nAN7o1%2ByyqLBAi7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAQaDDc4NDY4NDQ0MTc3MSIMFTqWjr%2FPXL3AR%2FIXKt8DYcsHZJo2I6zF86g7K3qZE1JdmMPfhuNejKmvNev2f1f9bef%2BF2Ui9wNQE4tIF7BCXDrW9kw401C2wFX3RXeYZMxI9yNIpIIW9fQbz%2FwO373uB%2FDCEFgmHpCTfQdTSxFgMh5aXotvYKKJF4Kf9OBkYl14WDU6lmHTAIKFCBPRk5DoKM6P5ZaKbP2mIMU5Zp6%2BYSOty5FBRQyKcCLKXqt68Ekih14FdbCzn7RcPou9kqzUhzW5%2FnMR3EjkfPMRQFxYoEGJAkiufx57FZ54RQwjiMtuYJK9x3h0rU4a2FAxdV6x%2F01bvnLGE6qu0ht%2BOwmdiKM7IttEc5FJw18%2FmxSwYIKNTpdPBBOwArhI%2FAjDZos5Wq1R4a9A97TMRo%2FkGKCKQ9WW8FGrIDi9CycrRElpaLoI8aaYPqBqhh6f5sBZpKAhTagvUQSv7TGnsRcbfbNdNI6tPnlB7YMmxiVOzeZf2MwIoT76h2YgwK6iC0CF0tOpG6Jo0pVRaBNprqbD9hHtDybIzOF0GGR0M4IDe3uUNMU92xLoaTI0TP6L7wNcHT3iUNJ60WVIW6BWDyMiBtjgfDW5KbpE%2B9dNxbFN2xu6bA4jVVNyNqAACYMH15%2FDC%2Bx7bSjf1xdJF5VLt8XcQDIwv%2BD%2FpAY6pQEs46aW3cza6w78w1wo0iOGW94mtQmuI%2FU3PcW1KSjHvd%2F8D2VbOnzNY5EJ9Q2HOMjCilPK5i%2FjyOFBhCdz%2BH1am0k%2F3rl7rjddnOe1BQ%2Br%2Bjn4evdDgmRVYSQwKxO2GfUqRfCjw3wKmKzgj0osYvLB9VKSRvDkmSMpciABVEmGbLmKOf6b7zCnuy8oV%2BYe%2Bg9oP196I%2FqGTBbTM1%2FVI6ReN5%2BbbAc%3D&Expires=16882190107",
]

for download_url in download_urls:
    download_file_from_nishika(download_url, dirpath=Path("./data"))
